<!DOCTYPE html>
<html lang="ru">
<%- include('../partials/head', { title: 'Прогресс: ' + username }) %>
<body class="bg-light theme-violet">
  <%- include('../partials/nav', { title: 'Прогресс пользователя' }) %>
  <div class="container py-4">
    <% if (typeof warning !== 'undefined' && warning) { %>
      <div class="alert alert-warning"><%= warning %></div>
    <% } %>
    <h5 class="mb-3">Пользователь: <code><%= username %></code></h5>
    <form class="row gy-2 gx-2 align-items-end" method="get" action="/admin/user/<%= encodeURIComponent(username) %>/progress">
      <div class="col-auto">
        <label class="form-label">Тема</label>
  <select name="topic" class="form-select js-autosubmit">
          <% topics.forEach(function(t){ %>
            <option value="<%= t.name %>" <%= t.name===topic? 'selected':'' %>><%= t.name %></option>
          <% }) %>
        </select>
      </div>
    </form>

    <div class="mt-3">
      <div class="mb-2 text-muted small">Пройдено тестов: <strong><%= passed %></strong></div>
      <form method="post" class="d-inline" action="/admin/user-progress/mark">
        <input type="hidden" name="_csrf" value="<%= csrfToken %>">
        <input type="hidden" name="username" value="<%= username %>">
        <input type="hidden" name="topic" value="<%= topic %>">
        <input type="hidden" name="op" value="inc">
  <button class="btn btn-primary btn-sm">+1</button>
      </form>
      <form method="post" class="d-inline" action="/admin/user-progress/mark">
        <input type="hidden" name="_csrf" value="<%= csrfToken %>">
        <input type="hidden" name="username" value="<%= username %>">
        <input type="hidden" name="topic" value="<%= topic %>">
        <input type="hidden" name="op" value="dec">
        <button class="btn btn-warning btn-sm">-1</button>
      </form>
    </div>

    <div class="mt-4">
  <form class="row gy-2 gx-2 align-items-end js-confirm" method="post" action="/admin/user-progress/set" data-confirm="Установить прогресс?">
        <input type="hidden" name="_csrf" value="<%= csrfToken %>">
        <input type="hidden" name="username" value="<%= username %>">
        <input type="hidden" name="topic" value="<%= topic %>">
        <div class="col-auto">
          <label class="form-label">Пройдено тестов</label>
          <input type="number" min="0" class="form-control" name="passed" value="<%= passed %>">
        </div>
        <div class="col-auto">
          <button class="btn btn-primary" type="submit">Сохранить</button>
        </div>
      </form>
    </div>

    <div class="mt-4">
      <h6>Справка</h6>
      <p class="text-muted small">«Пройдено тестов» — это unlockedCount - 1. Минимум 0, максимум — количество видео в теме.</p>
    </div>
  </div>
  <script src="/js/confirm.js?v=<%= assetVersion %>"></script>
  <script src="/js/admin-user-progress.js?v=<%= assetVersion %>"></script>
  <script src="/vendor/bootstrap/bootstrap.bundle.min.js"></script>
</body>
</html>
